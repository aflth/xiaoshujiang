---
title: Flask_åŸºç¡€çŸ¥è¯†
comments: true
date: 2018-06-13 10:21:02
tags: 
- Flask
- Python
categories:
- Flask
password:
summary_img:
---
<!-- more -->


##  Flask æ¡†æ¶ï¼ˆä¸€ï¼‰

### Flaskä»‹ç»

	- Flaskï¼šçŸ­å°ç²¾æ‚ï¼Œå†…éƒ¨æ²¡æœ‰å¤ªå¤šç»„ä»¶ï¼Œä½†æ˜¯æœ‰éå¸¸å¤šçš„æ‰©å±•ï¼Œå¯å®šåˆ¶æ€§å¼ºã€‚
	- Djangoï¼š é‡æ­¦å™¨ï¼Œå†…éƒ¨æœ‰éå¸¸å¤šçš„ç»„ä»¶ï¼ŒORMã€formã€model formã€ç¼“å­˜ã€sessionã€ä¸­é—´ä»¶
	- TOrandoï¼šé‡è¦çš„ç”¨é€”å¼‚æ­¥éå µå¡

### Flaskå¿«é€Ÿå…¥é—¨

	- å®‰è£…flask
		- pip3 install flask

### åˆè¯†Flask

``` python
from flask import Flask, render_template, request, redirect, url_for
app = Flask(__name__)  # åˆå§‹åŒ–

USER_DATA = {
    1:{"name":"dove", "age":18, "text":"åšä¸ªä¿—äººï¼Œè¿½æ±‚çˆ±å’Œè‡ªç”±"},
    2:{"name":"sove", "age":28, "text":"åšä¸ªä¿—äººï¼Œæ´»å¾—åƒç‹—ï¼Œçˆ±ä¸è¢«çˆ±"}
}
@app.route("/", methods=["GET"])  # ä½¿ç”¨methodsæ¥æ·»åŠ é—®æ¨¡å¼ï¼Œä»¥å­—å…¸çš„å½¢å¼ï¼Œå¦‚æœé»˜è®¤ä½¿ç”¨getæ–¹æ³•
def index():
    """é¦–é¡µ"""
    # ä½¿ç”¨render_templateæ¥å¯¼å…¥æ¨¡æ¿ï¼Œé»˜è®¤æ¨¡æ¿æ”¾åœ¨templatesæ–‡ä»¶å¤¹ä¸­ï¼Œä¹Ÿå¯ä¿®æ”¹ã€‚
    return render_template("index.html")

# ä½¿ç”¨endpoint å¯ä»¥ç»™urlèµ·ä¸€ä¸ªåˆ«åï¼Œé€šè¿‡url_foråå‘ç”Ÿæˆ
@app.route("/login", methods=["GET", "POST"])
def login():
    """ç™»é™†é¡µé¢"""
    # ä½¿ç”¨request.method æ¥è·å–ç”¨æˆ·è¯·æ±‚æ–¹å¼
    # ä½¿ç”¨request.query_string æ¥è·å–urlä¿¡æ¯
    print(request.query_string)
    if request.method == "GET":
        # é€šè¿‡url_for åå‘ç”Ÿæˆ /login é€‚ç”¨äºurlæ¯”è¾ƒé•¿çš„æƒ…å†µ
        #url = url_for("login")
        return render_template("login.html")
    # ä½¿ç”¨request.form æ¥è·å–è¡¨å•ä¿¡æ¯
    username = request.form.get("name")
    password = request.form.get("psw")
    if username == "dove" and password == "123":
    # æ¨¡å—redirectå¯ä»¥è·³è½¬åˆ°ä»»æ„ç½‘é¡µæˆ–è€…è·¯ç”±
        return redirect("/data")
    return render_template("login.html", error = "è¾“å…¥ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼")
@app.route("/data", methods=["GET"])
def data():
    """ç”¨æˆ·ç™»é™†æˆåŠŸæ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨ï¼Œå¹¶æœ‰æŸ¥çœ‹è¯¦æƒ…çš„åŠŸèƒ½"""
    # ps: å½“render_templateä¼ å…¥ä¸€ä¸ªå­—å…¸æ—¶ï¼Œå¯ä»¥ç”¨forå¾ªç¯ä½†æ˜¯ï¼Œè¦å†™æˆdata.items()åŠ æ‹¬å·
    return render_template("data.html", data=USER_DATA)
@app.route("/data/<int:nid>")  # åœ¨è·¯ç”±ä¸­<>å¯ä»¥è¾“å…¥å‚æ•°ï¼Œä¹Ÿå¯ä»¥ç­›é€‰ç±»å‹ã€‚
def data_sting(nid):
    data = USER_DATA.get(nid)
    return render_template("data_string.html", data=data)

if __name__ == "__main__":
    app.run(debug=True)
```
>  è¿™ä¸ªåˆè¯†æœ‰ç‚¹éš¾å•Šï¼ŒğŸ˜‚

### 1. ç¨‹åºçš„åŸºæœ¬ç»“æ„

#### 1.1 åˆå§‹åŒ–
		- åˆå§‹åŒ–ï¼š å®ä¾‹åŒ–ä¸€ä¸ªFlaskå¯¹è±¡
		- app = Flask(__name__) å…¶ä¸­__name__ æ˜¯ä¼ å…¥æ–‡ä»¶åç§°
		- è·¯ç”±å’Œè§†å›¾å‡½æ•°
			- å…¶ä¸­è·¯ç”±æ˜¯@app.route("è¿™æ˜¯è·¯ç”±åœ°å€", methods=["GET","POST"]) methodsæ˜¯ç”¨æˆ·è¯·æ±‚æ–¹å¼ï¼Œæœ‰å¤šç§è¯·æ±‚æ–¹å¼ï¼Œç”¨åˆ—è¡¨åŒ…å«èµ·æ¥ã€‚è·¯ç”±æ˜¯å¤„ç†urlå’Œè§†å›¾å‡½æ•°ä¹‹é—´å…³ç³»çš„ç¨‹åºã€‚
			- è§†å›¾å‡½æ•°å°±æ˜¯:è¢«è£…é¥°å™¨è£…é¥°çš„å‡½æ•°ã€‚å°±æ˜¯è¿™ä¹ˆç®€å•æ˜äº†ï¼ŒğŸ˜„
		- å¯åŠ¨æœåŠ¡ï¼š å°±æ˜¯
```python
if __name__ == "__main__":
	app.run()
	# è¿™å°±æ˜¯ä¸ºäº†é˜²æ­¢åœ¨å½“æ¨¡å—è°ƒç”¨æ—¶ï¼Œæ‰§è¡Œä¸¤æ¬¡ã€‚
```
+ Flaskæ‰©å±•
- Flaskæ‰©å±•æœ‰å¾ˆå¤šï¼Œ å¯ä»¥åœ¨å®˜ç½‘ä¸ŠæŸ¥çœ‹
- å…¶å®æœ€é‡è¦çš„å°±æ˜¯Flaskçš„æ‰©å±•ï¼Œè¿™æ‰æ˜¯ä»–è‡ªå·±çš„å¼ºå¤§ä¹‹å¤„ã€‚
### 1.2 æ¨¡æ¿
- Flaskä½¿ç”¨jinja2æ¨¡æ¿
- ä½¿ç”¨render_templateæ¥å¯¼å…¥æ¨¡æ¿ï¼Œé»˜è®¤æ¨¡æ¿æ”¾åœ¨templatesæ–‡ä»¶å¤¹ä¸­ï¼Œä¹Ÿå¯ä¿®æ”¹ã€‚å…¶ä¸­å¯ä»¥æŸ¥çœ‹æºç ï¼Œæ˜¯æ€ä¹ˆå®šä¹‰çš„ã€‚
- åœ¨staticsæ–‡ä»¶å¤¹ä¸­è°ƒç”¨cssï¼Œjsç­‰æ–‡ä»¶
- æ¨¡æ¿çš„æ¸²æŸ“ï¼šå°±åœ¨æ¨¡æ¿ä¸­è®¾ç½®å˜é‡ç”¨æ¥å ä½ç½®ï¼ŒçœŸå®å€¼æ›¿æ¢å˜é‡ï¼Œåœ¨è¿”å›å­—ç¬¦ä¸²çš„è¿‡ç¨‹ã€‚
- å˜é‡ï¼šåœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ {{ å˜é‡åç§° }} ,åœ¨render_tenpalte("æ¨¡æ¿.html", å˜é‡åç§°=çœŸå®å€¼ï¼‰ ç”¨è¿™æ ·çš„æ–¹æ³•ä¼ å…¥å˜é‡ã€‚
- ç»“æ„æ§åˆ¶ï¼šåœ¨æ¨¡æ¿ä¸­ä¹Ÿå¯ä½¿ç”¨forå¾ªç¯ï¼Œifåˆ¤æ–­ï¼Œç­‰æ§åˆ¶ç»“æ„ï¼Œ

```html
# html ä¸­çš„æ§åˆ¶ç»“æ„
info = {
1:{ "name":"haha", "age":23, },
1:{ "name":"llalaj", "age":23, },
1:{ "name":"nana", "age":23, },
{% for k,v in info.itmes() %}
<h1>	{{ k }} </h1>
<h1>	{{ v.name}} </h1>
<h1>	{{ v.get("name"}} </h1>
<h1>	{{ v.["name"]}} </h1>
{% endfor %}
# è¿™æ˜¯åœ¨htmlä¸­ä½¿ç”¨å­—å…¸ï¼Œè·å–å­—å…¸ä¸­çš„é”®å€¼å¯¹ï¼Œå…¶ä¸­æ³¨æ„çš„æ˜¯ï¼Œè·å–vçš„ä¸‰ç§æ–¹å¼ã€‚
```

- **jinja2æ¨¡æ¿ä¸­çš„å˜é‡æ§åˆ¶å™¨**
	- åœ¨jinja2ä¸­å˜é‡æ§åˆ¶å™¨çš„ä½¿ç”¨ï¼š{{ å˜é‡|safe }} è¿™è¡¨ç¤ºåœ¨æ¸²æŸ“æ¨¡æ¿æ—¶ï¼Œå¯¹å˜é‡ä¸è¿›è¡Œè½¬ç§»
	- safe -- æ¸²æŸ“å€¼ä¸è½¬ä¹‰(ps: åœ¨ä¸å¯ä¿¡ä»»çš„å€¼ä¸å¯ä½¿ç”¨ï¼‰
	- cpitalize -- æŠŠå€¼çš„é¦–å­—æ¯è½¬åŒ–æˆå¤§å†™ï¼Œå…¶ä»–å­—æ¯è½¬æ¢æˆå°å†™
	- lower -- æŠŠå€¼è½¬åŒ–æˆå°å†™å½¢å¼
	- upper -- æŠŠå€¼è½¬åŒ–æˆå¤§å†™å½¢å¼
	- title -- æŠŠå€¼ä¸­æ¯ä¸ªå•è¯çš„é¦–å­—æ¯éƒ½è½¬åŒ–æˆå¤§å†™ï¼ˆæ³¨æ„ä¸cpiltalizeçš„åŒºåˆ«ï¼‰
	- trim -- æŠŠå€¼çš„é¦–ä½ç©ºæ ¼å»æ‰
	- striptags -- æ¸²æŸ“ä¹‹å‰æŠŠå€¼ä¸­æ‰€æœ‰çš„HTMLæ ‡ç­¾éƒ½åˆ æ‰
#### 1.2.1 è‡ªå®šä¹‰é¡µé¢é”™è¯¯ï¼šè‡ªå®šä¹‰é¢œé¢
-è‡ªå®šä¹‰é¡µé¢é”™è¯¯æ˜¯ï¼Œä¿®æ”¹æµè§ˆå™¨çš„é”™è¯¯é¡µé¢ï¼Œä¸ºäº†ç¾åŒ–ã€‚
```python
# å®šä¹‰404é”™è¯¯é¡µé¢
@app.errorhandler(404)
def page_not_found():
	return render_template("404.html"),404
# å®šä¹‰500 é”™è¯¯é¡µé¢
@app.errorhandler(500)
def page_not_found():
	return render_template("500.html"),404
```
- è¿™æ—¶åªéœ€è¦ä¿®æ”¹404.HTMLï¼Œå°±å¯ä»¥ä¿®æ”¹æµè§ˆå™¨çš„404é”™è¯¯é¡µé¢ã€‚

#### 1.2.2 æ¨¡æ¿çš„ç»§æ‰¿
- è¿™ä¸ªæ¯”è¾ƒé‡è¦ä½†æ˜¯è¿˜æ²¡ä¼šï¼Œ ğŸ˜„

#### 1.2.3 é“¾æ¥

- url_for() è¿™ä¸ªæ–¹æ³•ä½œç”¨å°±æ˜¯ç»™urlèµ·ä¸€ä¸ªåˆ«åï¼Œé»˜è®¤è§†å›¾å‡½æ•°çš„åç§°ã€‚
- @app.route("/a/b/c/d/e/f", methods=["POST"], endpoint="åˆ«å")
- è¿™å°±æ˜¯ç”¨æ³•ï¼Œé»˜è®¤ "åˆ«å" ä¸ºè§†å›¾å‡½æ•°åç§°ã€‚



### 1.3 sessionä¸Cooke

- session,cookeæ˜¯è®°å½•ç”¨æˆ·ç™»é™†çŠ¶æ€çš„ä¸€ç§æœºåˆ¶ï¼Œä½†æ˜¯ä¸€ä¸ªæ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨ï¼Œä¸€ä¸ªå­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ï¼Œé€šè¿‡éªŒè¯è¿™ä¸¤ä¸ªå€¼æ¥ç¡®å®šç”¨æˆ·ä¿¡æ¯ã€‚
- ä¸ºäº†é˜²æ­¢sessionè¢«ç¯¡æ”¹ï¼Œä½¿ç”¨åŠ ç›çš„æ–¹å¼æ¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚
- è®¾ç½®ç›ï¼š app.secret_key = " æ‰€åŠ çš„ç›"


### 1.4 Flaskçš„é…ç½®æ–‡ä»¶

#### 1.4.1 ä¸‰ç§å¸¸ç”¨çš„é…ç½®æ–‡ä»¶å¼•å…¥

+ ç›´æ¥åœ¨ä¸»å‡½æ•°ä¸­é…ç½®
+ é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®
+ åŠ è½½é…ç½®å¯¹è±¡è¿›è¡Œé…ç½®

##### 1.4.2 ç›´æ¥åœ¨ä¸»å‡½æ•°ä¸­é…ç½®æ–‡ä»¶
- é€šè¿‡app.config["DEBUG"] = True è¿›è¡Œé…ç½®

```python 

from flask import Flask, render_template, redirect
"""
ç¬¬ä¸€ç§é…ç½®æ–¹æ³•ï¼š
    ç›´æ¥é…ç½®
"""
app = Flask(__name__)
app.config["DEBUG"] = True
app.config["SECRET_KEY"] = "ç›´æ¥é…ç½®è¿›è¡Œé…ç½®sessionå¯†é’¥"
@app.route("/", methods=["GET"])
def index():
    print(app.config)
    return render_template("index.html")

if __name__ == "__main__":
    app.run()
```
##### 1.4.3 é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®
- é€šè¿‡app.config.from_pyfile("config.py) è¿›è¡Œé…ç½®ï¼Œå…¶ä¸­config.py è¦å’Œä¸»å‡½æ•°åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œåœ¨config.py ä¸­ç”¨ **DEBUG=True**çš„æ–¹å¼æ¥è®¾ç½®å€¼

```python
from flask import Flask, render_template, redirect

"""
ç¬¬äºŒç§é…ç½®æ–¹å¼ï¼š
    é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®
    é…ç½®æ–‡ä»¶ä¸ºï¼š config.py
"""
app = Flask(__name__)
#
app.config.from_pyfile("./config.py")
@app.route("/", methods=["GET"])
def index():
    print(app.config)
    return render_template("index.html")

if __name__ == "__main__":
    app.run()
```
##### 1.4.4 é€šè¿‡å¼•å…¥ç±»è¿›è¡Œé…ç½®ï¼Œï¼ˆå¸¸ç”¨ï¼‰
- é€šè¿‡ form app.Configlist import * å¯¼å…¥æ¨¡å—ï¼ˆè¿™é‡Œä½¿ç”¨app.Configlist æ˜¯å› ä¸ºæˆ‘çš„æ‰€æœ‰æ–‡ä»¶éƒ½åœ¨appçš„æ–‡ä»¶å¤¹ä¸­æ”¾ç½®ï¼‰
- é€šè¿‡app.config.from_object(Configlistä¸­çš„ç±»åï¼‰ä¹‹æ‰€ä»¥æœ‰ä¸¤ç§è°ƒç”¨æ–¹å¼ï¼Œæ˜¯å› ä¸ºç±»åå¤ªé•¿ï¼Œé€šè¿‡å­—å…¸é”®å€¼å¯¹ï¼Œæ¥è¿›è¡Œæ˜ å°„ã€‚
- é€šè¿‡ç±»è¿›è¡Œå¼•å…¥é…ç½®ï¼Œå¯ä»¥å‡å°‘ä¸»å‡½æ•°ä»£ç ä¸­çš„æ”¹åŠ¨ï¼Œåˆ©ç”¨ç±»çš„ç»§æ‰¿ï¼Œä»è€Œè¿›è¡Œé…ç½®æ–‡ä»¶è°ƒæ¢ã€‚

```python
from flask import Flask, render_template
# è¦å¯¹é…ç½®æ–‡ä»¶è¿›è¡Œå¯¼å…¥.Ps: åœ¨å¯¼å…¥æ¨¡å—æ—¶æ³¨æ„æ¨¡å—çš„è·¯å¾„ã€‚
from app.Configlist import *
"""
ç¬¬äºŒç§é…ç½®æ–¹å¼ï¼š
    é€šè¿‡å¯¹è±¡åŠ è½½é…ç½® ï¼ˆå¸¸ç”¨çš„ä¸€ç§æ–¹å¼ï¼‰
    é…ç½®æ–‡ä»¶ä¸ºï¼š Configlist.py
"""
app = Flask(__name__)
# ç¬¬ä¸€ç§è°ƒç”¨æ–¹å¼
#app.config.from_object(ProductionConfig)
# ç¬¬äºŒç§è°ƒç”¨
app.config.from_object(config["Dev"])
@app.route("/", methods=["GET"])
def index():
    print(app.config)
    return render_template("index.html")

if __name__ == "__main__":
    app.run()
```
#### 1.5 __init__æ–¹æ³•çš„ä½¿ç”¨(FLaskä¸­çš„è“å›¾ï¼‰
>  é€šè¿‡__init__æ–¹æ³•çš„å­¦ä¹ å¼•å‡ºè“å›¾ï¼ˆBlueprint)

##### 1.5.1

- __init__.py æ–‡ä»¶çš„ä½œç”¨ï¼šå°±æ˜¯å°†ä¸€ä¸ªæ–‡ä»¶å¤¹å˜æˆä¸€ä¸ªpythonæ¨¡å—ï¼Œpythonæ¨¡å—ä¸­éƒ½æœ‰__init__.pyæ–‡ä»¶ã€‚
-  è¿™å…¶ä¸­åŒ…æ‹¬ å¯¼å…¥çš„å‡ ç§æ–¹å¼ï¼š
	-  1. import å¯¼å…¥ ï¼šç›´æ¥å¯¼å…¥æ¨¡å—ï¼Œä½†æ˜¯é˜²æ­¢äºŒæ¬¡è¿è¡Œï¼Œif  __name__  åˆ¤æ–­ï¼Œç¼ºç‚¹ï¼š æ¯æ¬¡éƒ½è¦è¾“å…¥ç±»å(å¯ä»¥ç”¨ import ç±»å as æ–°ç±»å)ï¼Œå¹¶ä¸”å¯¼å…¥ä¸€ä¸ªæ¨¡å—ä¸­å¤šä¸ªç±»çš„æ—¶å€™ï¼Œä¸æ˜¯å¾ˆæ–¹ä¾¿..
	-  2. from æ¨¡å— import ç±»åï¼Œ  è¿™æ ·å°±å¯ä»¥ç›´æ¥ ç±»å.æ–¹æ³•() ä½¿ç”¨ ï¼Œ ä¹Ÿå¯ä»¥æ–¹ä¾¿çš„çœ‹å‡ºå“ªä¸ªæ–¹æ³•åœ¨é‚£ä¸ªç±»ä¸­ã€‚
	-  3. from æ¨¡å— import * ï¼Œ è°ƒç”¨æ‰€ç”¨æ¨¡å—ä¸­çš„æ–¹æ³•ï¼Œä½†æ˜¯è¦æ³¨æ„çš„æ˜¯å…¨å±€å‘½åï¼Œ å¦‚æœï¼Œä¸ç±»ä¸­çš„æ–¹æ³•å‘½åç›¸åŒå¯èƒ½æŠ¥é”™ï¼Œæˆ–è€…ï¼Œå‡ºç°æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚

##### 1.5.2  åˆ©ç”¨__init__æ–¹æ³• æ¥åˆ›å»º blueprint 




# ä»Šå¤©æœ€é‡è¦çš„æ˜¯ **å¼€æ”¾å°é—­**åŸåˆ™ã€‚
# è£…é¥°å™¨çš„functools.wrgs(func)ï¼Œä¿å­˜å‡½æ•°çš„å…ƒä¿¡æ¯
# ä»¥åŠå¦‚ä½•ä½¿ç”¨é…ç½®æ¥å®ç°å¼€æ”¾å°é—­åŸåˆ™çš„å®ç°ã€‚